<!DOCTYPE html>

<html>
    <head>
        <title>video19</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="d3.v3.min.js" charset="utf-8"></script>
    </head>
    
    
    <body>
    	<p>The Treemap Layout</p>
    </body>
    
    
    <script>
		var data =
		{
			"name":"Max",
			"value":100,
			"children":[
				{
					"name":"Sylvia",
					"value":75,
					"children":[
						{"name":"Craig", "value":25},
						{"name":"Robin", "value":25},	
						{"name":"Anna", "value":25}					
					]
				},
				{
					"name":"David",
					"value":75,
					"children":[
						{"name":"Jeff", "value":25},
						{"name":"Robin", "value":25}
					]
				},
				{
					"name":"MrX",
					"value":75
				}
			]
		}
		
	
		var canvas = d3.select("body").append("svg")
			.attr("width", 500)
			.attr("height", 500);
					
		var treemap = d3.layout.treemap()
			.size([500,500])
			.nodes(data)
			
		var cells = canvas.selectAll(".cell")
			.data(treemap)
			.enter()
			.append("g")
			
		var colorScale = d3.scale.category10()
		
		cells.append("rect")
			.attr("x", function(t){return t.x})
			.attr("y", function(t){return t.y})
			.attr("width", function(t){return t.dx})
			.attr("height", function(t){return t.dy})
			.attr("fill", function(t){
				if (t.children == null) return colorScale(t.parent.name)	// 根据业务需求, 取最下一层
			})
			.attr("stroke", "#fff")
			
		cells.append("text")
			.text(function(t){
				if (t.children == null) return t.name
			})
			.attr("x", function(t){return t.x + t.dx/2})
			.attr("y", function(t){return t.y + t.dy/2})
			.attr("text-anchor", "middle")			//原来以文字起始点为锚点, 现在指定中心点为锚点
    </script>
</html>
